Bacula Infrastructure SOP

   Bacula is our backup solution. Our backups run to backup01 and ultimately
   to a tape robot. There is also a backup03 now with a newer bacula and tape
   library. 

   Contents

     * 1 Contact Information
     * 2 Troubleshooting and Resolution

          * 2.1 Intervention Required

     * 3 Mysql insert failures

Contact Information

   Owner: Fedora Infrastructure Team

   Contact: #fedora-admin, sysadmin-main, sysadmin-backup

   Location: Phoenix

   Servers: backup01, backup02

   Purpose: Our backup solution

Troubleshooting and Resolution

   You can get to the bacula management console with:

   sudo /usr/sbin/bconsole

   From there you can get a overview status with:

   status dir

   Or a more specific status on the tape drive with:

   status 2 2

  Intervention Required

   If the tapes fill up, it may be required to purge the oldest volume. This
   is done with the purge command. Select volume, then a list of volumes
   comes up. Pick the oldest volume that has not already been purged or
   recycled.

   list volumes

   then

   purge

   It will ask you for the media-id or volume -id. Enter the one from the
   oldest tape listed above in list volumes.

   After that the oldest tape will be purged, but bacula may not resume on it
   yet. You need to load the tape to make sure it realizes it can go on:

   mount

   It will ask for the device (say tape), then ask for the slot id. Enter the
   number from above in list volumes.

Mysql insert failures

   Sometimes backups will fail with a:

   Fatal error: Can't fill File table Query failed: INSERT INTO File
   (FileIndex, JobId, PathId, FilenameId, LStat, MD5)SELECT batch.FileIndex,
   batch.JobId, Path.PathId, Filename.FilenameId,batch.LStat, batch.MD5 FROM
   batch JOIN Path ON (batch.Path = Path.Path) JOIN Filename ON (batch.Name =
   Filename.Name): ERR=Lock wait timeout exceeded; try restarting transaction

   This error is a issue with the old bacula and mysql we have, and there's
   not much to be done about it. Start a new backup if one is needed or wait
   for the next backup to complete.
